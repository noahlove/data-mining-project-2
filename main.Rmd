---
title: "Main-Project"
author: "Noah Love and Ido Li On"
date: "3/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, message=FALSE, warning=FALSE, include=FALSE}

library(tidyverse)
library(tidyjson)
```

# Project 2

## The data

So the data is presented in a json file. It is a list of 16 (or 20 for 2021) lists, each representing a unique job category: i.e. ux designer, recruiter or marketing. Within each of the 16 lists, are 2 lists: the first is a list of 4, describing position, location, job time (full or part time), and start time. The second list contains job descriptions associated with that job category.

```{r echo=FALSE}
indeed_2020_raw <- fromJSON("Indeed_data/indeed_job_descs_2020_09_20.json")

indeed_2021 <- fromJSON("Indeed_data/indeed_job_descs_2021_01_25.json")
```

### Clean up the data

Here is an example of the list of categories, and associated characteristics.

```{r echo=FALSE}
df_json20 <- indeed_2020_raw %>% 
  map_if(is.data.frame, list) %>% 
  as_tibble()

head(df_json20$request_params)

request_parameters <- as.data.frame(df_json20$request_params)

```

Here is an example of a job description:

```{r echo=FALSE}
#list, because of nested format? 
job_descriptions <- df_json20$job_descriptions

#what types of jobs

job_categories <- request_parameters$q

```

### Can the data be representative?

```{r echo=FALSE}
job_categories
```

First, there are only 16 categories here. Definitely not a comprehensive view of the job market, so if you are really set about going into a field that is not listed, this loop project explained below would not be a good fit. 

Another question that would be reasonable to ask is what is the distribution of job postings per category?



```{r echo=FALSE, message=FALSE, warning=FALSE}
# They are all in new york so I'm throwing out the state column
# unique(long_df$l)

#Similarly, there is only full time positions available.
#unique(long_df$part_or_full)

#convert to long tibble instead of wide

#There is still a problem here. Some of these don't keep the description for some reason

unnested_dataframe <- unnest(df_json20, cols = )

dim(unnested_dataframe)

#unnested_dataframe  # this shows unnesting works appropriately

long_df <- unnested_dataframe %>% 
  pivot_longer(cols = 5:574, names_to = "post_id", values_to = "description", values_drop_na = FALSE) %>% # it is this line that messes things up, it appears that every other category is appropriately grouped into the column.
  select(-l, -jt) %>% 
  rename(category = q)

long_df

```

```{r}
#see how many na per group
na_numbers <- long_df %>% 
  group_by(category) %>% 
  summarise(non_na_count = sum(!is.na(description)))

ggplot(data = na_numbers, aes(x = category, y = non_na_count)) + 
  geom_bar(stat = "identity") + 
  ggtitle("Distribution of the jobs by category for 2020") + 
  coord_flip()

```


Hopefully you don't want to be a HR specialist because the data is not as comprehensive than the rest. But otherwise, it seems to be very equal across the categories. 


Here is an (shortened) example of how it appears in JSON:

> "2ccc2596d13c54d4": "Job to be done\nWe\u2019re the best way to get better.\n\nAbout Buoy Health:\nBuoy builds a digital health tool that helps people \u2013 from the moment they get sick \u2013 start their health care on the right foot. Started by a team of doctors and computer scientists working at the Harvard Innovation Laboratory in Boston MA, Buoy was developed in direct response to the downward spiral we\u2019ve all faced when we attempt to self-diagnose our symptoms online...."

### Data Quality Issue
Some companies appear to have gotten lazy in their copy and pasting between websites and have smashed some words together. Because it is a rare enough occurrence, it will hopefully not have a large effect on the data. 


## Tokenize the data

```{r}
unnest(df_json20, cols = )
```


```{r}
# doesn't work for second category
# long_df
```



